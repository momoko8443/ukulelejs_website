!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=n(1),o=n(2),a=n(3),l=n(13),u=n(16),s=n(10),c=n(14),p=n(15),f=function(e){function t(){e.apply(this,arguments),this.asyncCaller=new o.AsyncCaller}return i(t,e),t.prototype.init=function(){var e=this;this.asyncCaller.exec(function(){e.manageApplication()})},t.prototype.handleElement=function(e){var t=this;this.analyizeElement(e,function(e){t.dispatchEvent(new p.Event(c.UkuEventType.HANDLE_ELEMENT_COMPLETED,e))})},t.prototype.registerController=function(e,t){this._internal_getDefinitionManager().addControllerDefinition(e,t)},t.prototype.getController=function(e){return this._internal_getDefinitionManager().getControllerDefinition(e).controllerInstance},t.prototype.registerComponent=function(e,t,n){this._internal_getDefinitionManager().addComponentDefinition(e,t,n,this.asyncCaller)},t.prototype.getComponent=function(e){return this._internal_getDefinitionManager().getComponent(e)},t.prototype.getComponentController=function(e){return this._internal_getDefinitionManager().getControllerInstByDomId(e)},t.prototype.refresh=function(e,t){this.dirtyChecker||(this.dirtyChecker=new l.DirtyChecker(this)),this.dirtyChecker.runDirtyChecking(e,t)},t.prototype._internal_getDefinitionManager=function(){return this.defMgr||(this.defMgr=new a.DefinitionManager(this)),this.defMgr},t.prototype._internal_dealWithElement=function(e){this.analyizeElement(e)},t.prototype.manageApplication=function(){var e=this,t=s.Selector.querySelectorAll(document,"[uku-application]");if(1!==t.length)throw new Error("Only one 'uku-application' can be declared in a whole html.");this.analyizeElement(t[0],function(t){e.dispatchEvent(new p.Event(c.UkuEventType.INITIALIZED,t))})},t.prototype.analyizeElement=function(e,t){var n=new u.Analyzer(this);t&&!function(e){n.addListener(u.Analyzer.ANALYIZE_COMPLETED,function(t){e(t.element)})}(t),n.analyizeElement(e)},t.INITIALIZED="initialized",t.REFRESH="refresh",t.HANDLE_ELEMENT_COMPLETED="handle_element_completed",t}(r.EventEmitter);t.Ukulele=f},function(e,t){"use strict";var n=function(){function e(){this.eventsPool={}}return e.prototype.getEventsPool=function(){return this.eventsPool},e.prototype.addListener=function(e,t){this.eventsPool[e]||(this.eventsPool[e]=[]),this.eventsPool[e].push(t)},e.prototype.removeListener=function(e,t){if(this.eventsPool[e])for(var n=this.eventsPool[e].length-1;n>=0;n--)if(this.eventsPool[e][n]===t){this.eventsPool[e].splice(n,1);break}},e.prototype.hasListener=function(e){return!!(this.eventsPool[e]&&this.eventsPool[e].length>0)},e.prototype.dispatchEvent=function(e){if(e&&e.eventType){var t=this.eventsPool[e.eventType];if(t)for(var n=0;n<t.length;n++)t[n].call(this,e)}},e}();t.EventEmitter=n},function(e,t){"use strict";var n=function(){function e(e,t){this.func=e,this.argu=t}return e}(),i=function(){function e(){this.allTasksPool=[],this.queueTasksPool=[],this.execType="queue",this.errorMsg="Only one type of task can be executed at same time",Function.prototype.resolve=function(e){e.aysncFunRunOver.call(e,this)}}return e.prototype.pushAll=function(e,t){if(0===this.queueTasksPool.length){var i=new n(e,t);this.allTasksPool.push(i)}else console.error(this.errorMsg);return this},e.prototype.pushQueue=function(e,t){if(0===this.allTasksPool.length){var i=new n(e,t);this.queueTasksPool.push(i)}else console.error(this.errorMsg);return this},e.prototype.aysncFunRunOver=function(e){if("queue"===this.execType)if(0===this.queueTasksPool.length)this.finalFunc&&this.finalFunc();else{var t=this.queueTasksPool[0];this.queueTasksPool.shift(),t.func.apply(t,t.argu)}else if("all"===this.execType){for(var n=0;n<this.allTasksPool.length;n++){var i=this.allTasksPool[n];if(e===i.func){this.allTasksPool.splice(n,1);break}}0===this.allTasksPool.length&&this.finalFunc&&this.finalFunc()}},e.prototype.exec=function(e){this.finalFunc=e,this.allTasksPool.length>0?(this.execType="all",this.executeAll()):this.queueTasksPool.length>0?(this.execType="queue",this.executeQueue()):this.finalFunc&&this.finalFunc()},e.prototype.executeQueue=function(){var e=this.queueTasksPool[0];this.queueTasksPool.shift(),e.func.apply(e,e.argu)},e.prototype.executeAll=function(){for(var e=0;e<this.allTasksPool.length;e++){var t=this.allTasksPool[e];t.func.apply(t,t.argu)}},e}();t.AsyncCaller=i},function(module,exports,__webpack_require__){"use strict";var ObjectUtil_1=__webpack_require__(4),Ajax_1=__webpack_require__(5),ControllerModel_1=__webpack_require__(6),AsyncCaller_1=__webpack_require__(2),ComponentModel_1=__webpack_require__(7),ComponentPoolItem_1=__webpack_require__(8),UkuleleUtil_1=__webpack_require__(9),DefinitionManager=function(){function DefinitionManager(e){this.controllersDefinition={},this.componentsDefinition={},this.componentsPool={},this.copyControllers={},this.dependentScriptsCache={},this.ajax=new Ajax_1.Ajax,this.uku=e}return DefinitionManager.prototype.getComponentsDefinition=function(){return this.componentsDefinition},DefinitionManager.prototype.getComponentsPool=function(){return this.componentsPool},DefinitionManager.prototype.setComponentsPool=function(e){this.componentsPool=e},DefinitionManager.prototype.setComponentsDefinition=function(e){this.componentsDefinition=e},DefinitionManager.prototype.getComponentDefinition=function(e){return this.componentsDefinition[e]},DefinitionManager.prototype.getControllerDefinition=function(e){return this.controllersDefinition[e]},DefinitionManager.prototype.getControllersDefinition=function(){return this.controllersDefinition},DefinitionManager.prototype.getComponent=function(e){return this.componentsPool[e]},DefinitionManager.prototype.getCopyControllers=function(){return this.copyControllers},DefinitionManager.prototype.copyAllController=function(){for(var e in this.controllersDefinition){var t=this.controllersDefinition[e],n=t.controllerInstance;this.copyControllerInstance(n,e)}},DefinitionManager.prototype.copyControllerInstance=function(e,t){var n=ObjectUtil_1.ObjectUtil.deepClone(e);delete this.copyControllers[t],this.copyControllers[t]=n},DefinitionManager.prototype.addControllerDefinition=function(e,t){var n=new ControllerModel_1.ControllerModel(e,t);t._alias=e,this.controllersDefinition[e]=n},DefinitionManager.prototype.getControllerInstByDomId=function(e){for(var t in this.controllersDefinition){var n=this.controllersDefinition[t],i=n.controllerInstance;if(i._dom&&i._dom.id===e)return i}},DefinitionManager.prototype.addComponentDefinition=function(e,t,n,i){function r(e,n){o.ajax.get(t,function(t){var n=UkuleleUtil_1.UkuleleUtil.getComponentConfiguration(t);o.analyizeComponent(e,n,function(){r.resolve(i)})})}var o=this;n?(this.componentsPool[e]=new ComponentPoolItem_1.ComponentPoolItem(e,t,!1),i.pushAll(r,[e,t])):this.componentsPool[e]=new ComponentPoolItem_1.ComponentPoolItem(e,t,!0)},DefinitionManager.prototype.addLazyComponentDefinition=function(e,t,n){var i=this;this.ajax.get(t,function(r){var o=UkuleleUtil_1.UkuleleUtil.getComponentConfiguration(r);i.analyizeComponent(e,o,function(){i.componentsPool[e]={tagName:e,templateUrl:t,lazy:!1},n()})})},DefinitionManager.prototype.getBoundAttributeValue=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=this.getBoundControllerModelByName(e),r=i.controllerInstance,o=[this.uku,r,e];o=o.concat(t);var a=UkuleleUtil_1.UkuleleUtil.getFinalValue.apply(null,o);return a},DefinitionManager.prototype.getControllerModelByName=function(e){return this.getBoundControllerModelByName(e)},DefinitionManager.prototype.getFinalValueByExpression=function(e){var t=this.getControllerModelByName(e).controllerInstance;return UkuleleUtil_1.UkuleleUtil.getFinalValue(this.uku,t,e)},DefinitionManager.prototype.getBoundControllerModelByName=function(e){var t=UkuleleUtil_1.UkuleleUtil.getBoundModelInstantName(e),n=this.controllersDefinition[t];if(!n){var i=e.split("."),r=i[0];if("parent"===r&&this.uku.parentUku)return i.shift(),e=i.join("."),this.uku.parentUku._internal_getDefinitionManager().getControllerModelByName(e)}return n},DefinitionManager.prototype.analyizeComponent=function(e,t,n){function i(e,t){if(a.dependentScriptsCache[t])i.resolve(e);else{var n=document.getElementsByTagName("HEAD")[0],r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",r.async=!0,r.src=t,r.onload=function(t){a.dependentScriptsCache[t.target.src]=!0,i.resolve(e)},n.appendChild(r)}}var r=this,o=t.dependentScripts,a=this;if(o&&o.length>0){var l,u=new AsyncCaller_1.AsyncCaller;"function"==typeof window.define&&window.define.amd&&(l=window.define,window.define=void 0);for(var s=0;s<o.length;s++){var c=o[s];u.pushAll(i,[u,c])}u.exec(function(){l&&(window.define=l),r.buildeComponentModel(e,t.template,t.componentControllerScript,t.stylesheet),n()})}else this.buildeComponentModel(e,t.template,t.componentControllerScript,t.stylesheet),n()},DefinitionManager.prototype.buildeComponentModel=function(tag,template,script,style){function dealWithShadowStyle(e,t){var n=document.getElementsByTagName("HEAD")[0],i=document.createElement("style");i.type="text/css";var r=t.split("}"),o=[];r.forEach(function(e,t){var n=e.replace(/^\s*/,"");n&&o.push(n)}),t=o.join("}\n."+e+" "),t="."+e+" "+t+"}",i.innerHTML=t,n.appendChild(i)}var debugComment="//# sourceURL="+tag+".js";try{var controllerClazz=void 0;script&&(script+=debugComment,controllerClazz=eval(script));var newComp=new ComponentModel_1.ComponentModel(tag,template,controllerClazz);this.componentsDefinition[tag]=newComp,style&&dealWithShadowStyle(tag,style)}catch(e){console.error(e)}},DefinitionManager}();exports.DefinitionManager=DefinitionManager},function(e,t){"use strict";var n=function(){function e(){}return e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.getType=function(t){var n=typeof t;return"object"===n&&e.isArray(t)?"array":n},e.compare=function(t,n){var i=e.getType(t),r=e.getType(n),o=!0;if(i!==r)return!1;switch(i){case"object":for(var a in t){var l=t[a],u=n[a],s=e.compare(l,u);if(!s){o=!1;break}}break;case"array":if(t.length===n.length)for(var c=0;c<t.length;c++){var p=t[c],f=n[c],h=e.compare(p,f);if(!h){o=!1;break}}else o=!1;break;case"function":o=t.toString()===n.toString();break;default:o=t===n}return o},e.deepClone=function(t){var n,i,r;if("object"!=typeof t||null===t)return t;if(t instanceof Array)for(n=[],i=0,r=t.length;r>i;i++)"object"==typeof t[i]&&null!==t[i]?n[i]=e.deepClone(t[i]):n[i]=t[i];else{n={};for(i in t)"object"==typeof t[i]&&null!==t[i]&&"_dom"!==i?n[i]=e.deepClone(t[i]):n[i]=t[i]}return n},e}();t.ObjectUtil=n},function(e,t){"use strict";var n=function(){function e(){}return e.prototype.get=function(e,t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.responseText):n&&n())},i.open("GET",e,!0),i.send(null)},e}();t.Ajax=n},function(e,t){"use strict";var n=function(){function e(e,t){this.alias=e,this.controllerInstance=t,this.boundItems=[]}return e.prototype.addBoundItem=function(e){this.boundItems.push(e)},e.prototype.getBoundItemsByName=function(e){for(var t=[],n=0;n<this.boundItems.length;n++){var i=this.boundItems[n];i.attributeName===e&&t.push(i)}return t},e}();t.ControllerModel=n},function(e,t){"use strict";var n=function(){function e(e,t,n){this.tagName=e,this.template=t,this.controllerClazz=n}return e}();t.ComponentModel=n},function(e,t){"use strict";var n=function(){function e(e,t,n){this.tagName=e,this.templateUrl=t,this.lazy=n}return e}();t.ComponentPoolItem=n},function(e,t,n){"use strict";var i=n(10),r=n(11),o=n(12),a=function(){function e(e,t){this.value=e,this.parent=t}return e}(),l=function(){function e(){}return e.getFinalAttribute=function(t){var n=t.split("."),i=n.shift();return"parent"===i?e.getFinalAttribute(n.join(".")):n.join(".")},e.searchHtmlTag=function(e,t){var n="^<"+t+"[\\s\\S]*>[\\s\\S]*</"+t+">$",i=new RegExp(n),r=e.search(i);return r},e.getInnerHtml=function(e,t){var n="<"+t+"[\\s\\S]*>[\\s\\S]*</"+t+">",i=new RegExp(n),r=e.match(i);if(r.index>-1){var o=r[0],a=o.search(">"),l=o.substr(a+1),u=l.lastIndexOf("</");return l=l.substring(0,u),l=l.replace(/(^\s*)|(\s*$)/g,""),console.log(l),l}return null},e.getComponentConfiguration=function(e){var t=document.createElement("div");t.innerHTML=e;for(var n=i.Selector.querySelectorAll(t,"template"),r=i.Selector.querySelectorAll(t,"script"),a=i.Selector.querySelectorAll(t,"style"),l=[],u=null,s=0;s<r.length;s++){var c=r[s];""!==c.src?l.push(c.src):u=c.innerHTML}return a&&a[0]?new o.ComponentConfiguration(n[0].innerHTML,l,u,a[0].innerHTML):new o.ComponentConfiguration(n[0].innerHTML,l,u)},e.searchUkuAttrTag=function(e){var t=/^uku\-.*/,n=e.search(t);return n},e.getAttrFromUkuTag=function(t,n){if(void 0===n&&(n=!1),0===e.searchUkuAttrTag(t)&&(t=t.replace("uku-","")),n){var i=t.split("-");t=i[0];for(var r=1;r<i.length;r++){var o=i[r].charAt(0).toUpperCase();t=t+o+i[r].substr(1)}}return t},e.searchUkuExpTag=function(e){var t=/^\{\{.*\}\}$/,n=e.search(t);return n},e.searchUkuFuncArg=function(e){var t=/\(.*\)$/,n=e.search(t);return n},e.isRepeat=function(e){return!!e.getAttribute("uku-repeat")},e.isInRepeat=function(e){for(var t=i.Selector.parents(e),n=0;n<t.length;n++){var r=t[n];if(9!==r.nodeType){var o=r.getAttribute("uku-repeat");if(o)return!0}}return!1},e.getBoundModelInstantName=function(e){var t=e.split(".")[0];return t?t:void 0},e.getAttributeFinalValue=function(t,n){var i=e.getAttributeFinalValueAndParent(t,n),r=i.value;return r},e.getAttributeFinalValueAndParent=function(t,n){var i,r=t;if("string"==typeof n){var o=e.getFinalAttribute(n),l=o.split(".");if(""!==o&&r)for(var u=0;u<l.length;u++){var s=l[u];if(i=r,r=r[s],void 0===r||null===r)break}else r=t.hasOwnProperty("_alias")&&t._alias===n?t:n}return new a(r,i)},e.getFinalValue=function(t,n,i){for(var o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];var l=-1;if("string"==typeof i&&(l=e.searchUkuFuncArg(i)),-1===l)return e.getAttributeFinalValue(n,i);var u=i.substring(0,l),s=e.getAttributeFinalValueAndParent(n,u),c=s.value;if(void 0===c)return c;var p=[],f=i.substring(l+1,i.length-1);if(""!==f)for(var h=r.ArgumentUtil.analyze(f,t),d=0;d<h.length;d++){var g=void 0,v=h[d],m=typeof v,y=null;if("string"===m){if(y=t._internal_getDefinitionManager().getControllerModelByName(v),y&&y.controllerInstance){var k=y.controllerInstance;g=1===v.split(".").length?k:e.getFinalValue(t,k,v)}else g=e.getFinalValue(t,n,v);p.push(g)}else p.push(v)}if(o){var C=Array.prototype.slice.call(o);p=p.concat(C)}return c=c.apply(s.parent,p)},e}();t.UkuleleUtil=l},function(e,t){"use strict";var n=function(){function e(){}return e.querySelectorAll=function(e,t){return window.hasOwnProperty("jQuery")&&"undefined"!=typeof window.jQuery?window.jQuery(e).find(t):e.querySelectorAll(t)},e.fuzzyFind=function(e,t){if(e&&e.attributes)for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n];if(i.nodeName.search(t)>-1)return e}return null},e.directText=function(e,t){for(var n="",i=e.childNodes,r=0;r<=i.length-1;r++){var o=i[r];if(3===o.nodeType){if(t||""===t||0===t||t===!1)return void(o.nodeValue=t);n+=o.nodeValue}}return n.trim()},e.parents=function(e){for(var t=[];e.parentNode&&"BODY"!==e.parentNode.tagName;)t.push(e.parentNode),e=e.parentNode;return t},e}();t.Selector=n},function(e,t){"use strict";var n=function(){function e(){}return e.analyze=function(e,t){e=e.replace(/'/g,'"');for(var n=e.split(","),i=0;i<n.length;i++){var r=n[i];for(var o in t._internal_getDefinitionManager().getControllersDefinition()){var a=r.search(o),l=r.search("parent.");(a>-1||l>-1)&&(n[i]='"'+r+'"')}}e=n.join(","),e="["+e+"]";try{var u=JSON.parse(e);return u}catch(s){return console.error(s),null}},e}();t.ArgumentUtil=n},function(e,t){"use strict";var n=function(){function e(e,t,n,i){void 0===i&&(i=void 0),this.template=e,this.dependentScripts=t,this.componentControllerScript=n,this.stylesheet=i}return e}();t.ComponentConfiguration=n},function(e,t,n){"use strict";var i=n(9),r=n(4),o=n(14),a=n(15),l=function(){function e(e){this.uku=e,this.defMgr=this.uku._internal_getDefinitionManager()}return e.prototype.runDirtyChecking=function(e,t){function n(e){var n=l.defMgr.getControllersDefinition()[e];if(!n)return void(l.uku.parentUku&&l.uku.parentUku.refresh(e));for(var u=n.controllerInstance,s=l.defMgr.getCopyControllers()[e],c=0,p=0;p<n.boundItems.length;p++){var f=n.boundItems[p],h=f.attributeName;if(h.search("parent.")>-1)return;if(s){f.hasOwnProperty("ukuTag")&&"selected"===f.ukuTag&&(h=h.split("|")[0]);var d=i.UkuleleUtil.getFinalValue(l.uku,u,h),g=i.UkuleleUtil.getFinalValue(l.uku,s,h);if(!r.ObjectUtil.compare(g,d)){h=f.attributeName;for(var v=n.getBoundItemsByName(h),m=0;m<v.length;m++){var y=v[m];(y.element!==t||f.hasOwnProperty("ukuTag")&&"value"!==y.ukuTag)&&(c++,y.render(u))}}}}c>0&&l.uku.hasListener(o.UkuEventType.REFRESH)&&l.uku.dispatchEvent(new a.Event(o.UkuEventType.REFRESH)),l.defMgr.copyControllerInstance(u,e)}var l=this;if(e){if("string"==typeof e)n(e);else if(r.ObjectUtil.isArray(e))for(var u=0;u<e.length;u++)n(e[u])}else for(var s in this.defMgr.getControllersDefinition())n(s)},e}();t.DirtyChecker=l},function(e,t){"use strict";var n=function(){function e(){}return e.INITIALIZED="initialized",e.REFRESH="refresh",e.HANDLE_ELEMENT_COMPLETED="handle_element_completed",e}();t.UkuEventType=n},function(e,t){"use strict";var n=function(){function e(e,t){this.eventType=e,this.element=t}return e}();t.Event=n},function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=n(1),o=n(9),a=n(2),l=n(17),u=n(19),s=n(20),c=n(21),p=n(22),f=n(23),h=n(24),d=n(10),g=n(15),v=function(e){function t(t){e.call(this),this.dealWithAttribute=function(e,t){var n=e.getAttribute("uku-"+t),i=this.defMgr.getControllerModelByName(n);if(i){var r=new l.BoundItemAttribute(n,t,e,this.uku);i.addBoundItem(r),r.render(i.controllerInstance),f.elementChangedBinder(e,t,i,this.uku.refresh,this.uku)}},this.uku=t,this.defMgr=this.uku._internal_getDefinitionManager()}return i(t,e),t.prototype.analyizeElement=function(e){var n=this;this.searchComponent(e,function(e){var i=[],r=d.Selector.fuzzyFind(e,"uku-");r&&i.push(r);for(var a=d.Selector.querySelectorAll(e,"*"),l=0;l<a.length;l++){var u=a[l],s=d.Selector.fuzzyFind(u,"uku-");s&&!o.UkuleleUtil.isInRepeat(s)&&i.push(s)}n.searchExpression(e);for(var c=0;c<i.length;c++)for(var p=i[c],f=n.sortAttributes(p),h=0;h<f.length;h++){var v=f[h];if(o.UkuleleUtil.searchUkuAttrTag(v.nodeName)>-1){var m=v.nodeName.split("-");m.shift();var y=m.join("-");"application"!==y&&(0===y.search("on")?o.UkuleleUtil.isRepeat(p)||o.UkuleleUtil.isInRepeat(p)||n.dealWithEvent(p,y):-1!==y.search("repeat")?n.dealWithRepeat(p):o.UkuleleUtil.isRepeat(p)||o.UkuleleUtil.isInRepeat(p)||("text"!==y?n.dealWithAttribute(p,y):n.dealWithInnerText(p)))}}n.defMgr.copyAllController(),n.hasListener(t.ANALYIZE_COMPLETED)&&n.dispatchEvent(new g.Event(t.ANALYIZE_COMPLETED,e))})},t.prototype.sortAttributes=function(e){for(var t=[],n=0;n<e.attributes.length;n++){var i=e.attributes[n];-1!==i.nodeName.search("uku-on")?t.push(i):t.unshift(i)}return t},t.prototype.searchComponent=function(e,t){var n=this,i=this.defMgr.getComponent(e.localName);if(i)if(i.lazy)this.defMgr.addLazyComponentDefinition(i.tagName,i.templateUrl,function(){var r=e.attributes,a=n.defMgr.getComponentsDefinition()[i.tagName];o.UkuleleUtil.isRepeat(e)||o.UkuleleUtil.isInRepeat(e)?t&&t(e):n.dealWithComponent(e,a.template,a.controllerClazz,r,function(e){t&&t(e)})});else{var r=e.attributes,l=this.defMgr.getComponentsDefinition()[i.tagName];o.UkuleleUtil.isRepeat(e)||o.UkuleleUtil.isInRepeat(e)?t&&t(e):this.dealWithComponent(e,l.template,l.controllerClazz,r,function(e){t&&t(e)})}else if(e.children&&e.children.length>0){for(var u=new a.AsyncCaller,s=0;s<e.children.length;s++){var c=e.children[s];u.pushQueue(this.searchComponent.bind(this),[c,function(){n.searchComponent.resolve(u)}])}u.exec(function(){t&&t(e)})}else t&&t(e)},t.prototype.dealWithComponent=function(e,t,n,i,r){var l=this,u="cc_"+Math.floor(1e4*Math.random()).toString();t=t.replace(new RegExp("'cc\\.","gm"),"'"+u+"."),t=t.replace(new RegExp('"cc\\.',"gm"),'"'+u+"."),t=t.replace(new RegExp("{{cc\\.","gm"),"{{"+u+"."),t=t.replace(new RegExp(" cc\\.","gm")," "+u+"."),t=t.replace(new RegExp("\\.cc\\.","gm"),"."+u+".");var s=document.createElement("div");s.insertAdjacentHTML("afterBegin",t),s.children.length>1&&(t=s.outerHTML),e.insertAdjacentHTML("beforeBegin",t);var c=e.previousElementSibling;c.classList.add(e.localName);var f;if(n){f=new n(this.uku),f._dom=c,f.fire=function(e,t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!0);var r=new Event(e.toLowerCase(),{bubbles:n,cancelable:i});r.data=t,f._dom.dispatchEvent(r)},this.uku.registerController(u,f);for(var h=0;h<i.length;h++){var d=i[h];if(0!==o.UkuleleUtil.searchUkuAttrTag(d.nodeName)||-1!==d.nodeName.search("uku-on")||"uku-render"===d.nodeName||"uku-visible"===d.nodeName)c.setAttribute(d.nodeName,d.nodeValue);else{var g=o.UkuleleUtil.getAttrFromUkuTag(d.nodeName,!0),v=this.defMgr.getControllerModelByName(d.nodeValue);if(v){var m=new p.BoundItemComponentAttribute(d.nodeValue,g,f,this.uku);v.addBoundItem(m),m.render(v.controllerInstance)}}}}else for(var h=0;h<i.length;h++){var d=i[h];0===o.UkuleleUtil.searchUkuAttrTag(d.nodeName)&&-1===d.nodeName.search("uku-on")&&"uku-render"!==d.nodeName&&"uku-visible"!==d.nodeName||c.setAttribute(d.nodeName,d.nodeValue)}if(e.parentNode.removeChild(e),c.children&&c.children.length>0){for(var y=new a.AsyncCaller,k=0;k<c.children.length;k++){var C=c.children[k];y.pushQueue(this.searchComponent.bind(this),[C,function(){l.searchComponent.resolve(y)}])}y.exec(function(){f&&f._initialized&&"function"==typeof f._initialized&&f._initialized(),r&&r(c)})}else f&&f._initialized&&"function"==typeof f._initialized&&f._initialized(),r&&r(c)},t.prototype.searchExpression=function(e){-1!==o.UkuleleUtil.searchUkuExpTag(d.Selector.directText(e))&&(o.UkuleleUtil.isRepeat(e)||o.UkuleleUtil.isInRepeat(e)||this.dealWithExpression(e));for(var t=0;t<e.children.length;t++)this.searchExpression(e.children[t])},t.prototype.dealWithExpression=function(e){var t=d.Selector.directText(e);if(-1!==o.UkuleleUtil.searchUkuExpTag(t)){var n=t.slice(2,-2),i=this.defMgr.getControllerModelByName(n);if(i){var r=new u.BoundItemExpression(n,t,e,this.uku);i.addBoundItem(r),r.render(i.controllerInstance)}}},t.prototype.dealWithInnerText=function(e){var t=e.getAttribute("uku-text");if(t){var n=this.defMgr.getControllerModelByName(t);if(n){var i=new s.BoundItemInnerText(t,e,this.uku);n.addBoundItem(i),i.render(n.controllerInstance)}}},t.prototype.dealWithEvent=function(e,t){var n=this,i=e.getAttribute("uku-"+t),r=t.substring(2);r=r.toLowerCase();var o=this.defMgr.getControllerModelByName(i);if(o){var a,l=o.controllerInstance,u=i.split(".");a="parent"===u[0]?u[1]:u[0],h.EventListener.addEventListener(e,r,function(t){n.defMgr.copyControllerInstance(l,a),n.defMgr.getBoundAttributeValue(i,t),n.uku.refresh(a,e)})}},t.prototype.dealWithRepeat=function(e){var t=e.getAttribute("uku-repeat"),n=t.split(" in "),i=n[0],r=n[1],o=this.defMgr.getControllerModelByName(r);if(o){var a=o.controllerInstance,l=new c.BoundItemRepeat(r,i,e,this.uku);o.addBoundItem(l),l.render(a)}},t.ANALYIZE_COMPLETED="analyizeCompleted",t}(r.EventEmitter);t.Analyzer=v},function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=n(18),o=n(9),a=function(e){function t(t,n,i,r){e.call(this,t,i,r),this.ukuTag=n}return i(t,e),t.prototype.render=function(e){var t,n=this.attributeName,i=this.element.tagName;if("selected"===this.ukuTag&&"SELECT"===i){var r=this.attributeName.split("|");n=r[0],t=r[1]}var a=o.UkuleleUtil.getFinalValue(this.uku,e,n);if(-1!==this.ukuTag.search("data-item"))a=JSON.stringify(a),this.element.setAttribute("data-item",a);else if("selected"===this.ukuTag&&"SELECT"===i){var l=void 0;l=t?a[t]:a,this.element.value=l}else if("checkbox"===this.element.getAttribute("type")&&"INPUT"===i&&"value"===this.ukuTag)this.element.checked=a;else if("value"===this.ukuTag)this.element.value=a;else if("radio"===this.element.getAttribute("type")&&"INPUT"===i&&"selected"===this.ukuTag)this.element.value===a&&this.element.setAttribute("checked","true");else if("IMG"===this.element.nodeName&&"src"===this.ukuTag)a&&this.element.setAttribute(this.ukuTag,a);else if("style"===this.ukuTag)for(var u in a)this.element.style[u]=a[u];else if("visible"===this.ukuTag)a?this.element.style.visibility="visible":this.element.style.visibility="hidden";else if("render"===this.ukuTag)if(a){var s=this.element.getAttribute("data-old-display");null!==s&&(this.element.style.display=s)}else{var s=this.element.getAttribute("data-old-display");null===s&&(s=this.element.style.display,this.element.setAttribute("data-old-display",s)),this.element.style.display="none"}else"disabled"===this.ukuTag?this.element.disabled=a:this.element.setAttribute(this.ukuTag,a)},t}(r.BoundItemBase);t.BoundItemAttribute=a},function(e,t){"use strict";var n=function(){function e(e,t,n){this.attributeName=e,this.element=t,this.uku=n}return e.prototype.render=function(e){},e}();t.BoundItemBase=n},function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=n(18),o=n(9),a=n(10),l=function(e){function t(t,n,i,r){e.call(this,t,i,r),this.expression=n}return i(t,e),t.prototype.render=function(e){var t=o.UkuleleUtil.getFinalValue(this.uku,e,this.attributeName);a.Selector.directText(this.element,t)},t}(r.BoundItemBase);t.BoundItemExpression=l},function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=n(18),o=n(9),a=function(e){function t(t,n,i){e.call(this,t,n,i),this.tagName="text"}return i(t,e),t.prototype.render=function(e){var t=o.UkuleleUtil.getFinalValue(this.uku,e,this.attributeName);this.element.innerHTML=t},t}(r.BoundItemBase);t.BoundItemInnerText=a},function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=n(18),o=n(9),a=function(e){function t(t,n,i,r){e.call(this,t,i,r),this.expression=n,this.renderTemplate=i.outerHTML,this.parentElement=i.parentNode,this.beginCommentString=void 0,this.endCommentString=void 0}return i(t,e),t.prototype.render=function(e){function t(){var e=o.UkuleleUtil.searchHtmlTag(i.renderTemplate,"tr");return-1===e?document.createElement("div"):document.createElement("tbody")}var n=o.UkuleleUtil.getFinalValue(this.uku,e,this.attributeName);if(n){var i=this;if(this.element&&this.element.parentNode){this.beginCommentString="begin uku-repeat: "+this.expression+" in "+this.attributeName;var r=document.createComment(this.beginCommentString);this.element.parentNode.insertBefore(r,this.element),this.endCommentString="end uku-repeat: "+this.expression+" in "+this.attributeName;var a=document.createComment(this.endCommentString);this.element.parentNode.insertBefore(a,this.element.nextSibling),this.element.parentNode.removeChild(this.element)}for(var l=document.createTreeWalker(this.parentElement,NodeFilter.SHOW_COMMENT,{acceptNode:function(e){return e.nodeValue===i.beginCommentString?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}},!1);l.nextNode();){var u=l.currentNode;if(u&&u.nodeValue===this.beginCommentString){for(;u.nextSibling&&u.nextSibling.nodeValue!==this.endCommentString;)u.parentNode.removeChild(u.nextSibling);var s=t(),c=t();u.parentNode.insertBefore(c,u.nextSibling);for(var p=0;p<n.length;p++)if(s.insertAdjacentHTML("beforeEnd",this.renderTemplate),p===n.length-1){var f=s.innerHTML;c.insertAdjacentHTML("beforeBegin",f),u.parentNode.removeChild(c),s=null,c=null}for(var h=u.nextSibling,d=0;d<n.length;d++){h.removeAttribute("uku-repeat");var g=this.uku.constructor,v=new g;v.parentUku=this.uku;var m=v.parentUku._internal_getDefinitionManager().getComponentsDefinition(),y=v.parentUku._internal_getDefinitionManager().getComponentsPool();v._internal_getDefinitionManager().setComponentsDefinition(m),v._internal_getDefinitionManager().setComponentsPool(y);var k=h.nextSibling,C=typeof n[d];if("object"===C)v.registerController(this.expression,n[d]);else{v.registerController(this.expression,{value:n[d]});var b=h.outerHTML.replace(new RegExp(this.expression,"gm"),this.expression+".value");h.insertAdjacentHTML("afterend",b);var E=h.nextSibling;h.parentNode.removeChild(h),h=E}v._internal_dealWithElement(h),h=k}}}if("OPTION"===this.element.tagName){var _=this.parentElement.getAttribute("uku-selected"),T=_.split("|");_=T[0];var A=T[1],U=this.uku._internal_getDefinitionManager().getFinalValueByExpression(_);A?this.parentElement.value=U[A]:this.parentElement.value=U}}},t}(r.BoundItemBase);t.BoundItemRepeat=a},function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=n(18),o=n(9),a=function(e){function t(t,n,i,r){e.call(this,t,null,r),this.ukuTag=n,this.componentController=i}return i(t,e),t.prototype.render=function(e){var t=o.UkuleleUtil.getFinalValue(this.uku,e,this.attributeName);this.componentController[this.ukuTag]=t,this.uku.refresh(this.componentController._alias)},t}(r.BoundItemBase);t.BoundItemComponentAttribute=a},function(e,t,n){"use strict";function i(e,t,n,i,o){for(var c=[r,a,l,u,s],p=0;p<c.length;p++){var f=c[p],h=f.apply(this,arguments);if(h)break}}function r(e,t,n,i,r){var a=e.tagName;if("INPUT"===a&&o(e)&&"value"===t){var l="change",u=e.getAttribute("type");return"text"===u&&(l="input"),p.EventListener.addEventListener(e,l,function(o){var a=e.getAttribute("uku-"+t);a=c.UkuleleUtil.getFinalAttribute(a);for(var l=a.split("."),u=n.controllerInstance,s=0;s<l.length-1;s++)u=u[l[s]];u[l[l.length-1]]=e.value,i&&i.call(r,n.alias,e)}),!0}return!1}function o(e){var t=e.getAttribute("type");return"checkbox"!==t&&"radio"!==t}function a(e,t,n,i,r){var o=e.tagName;return"TEXTAREA"===o&&"value"===t?(p.EventListener.addEventListener(e,"input",function(o){var a=e.getAttribute("uku-"+t);a=c.UkuleleUtil.getFinalAttribute(a);for(var l=a.split("."),u=n.controllerInstance,s=0;s<l.length-1;s++)u=u[l[s]];u[l[l.length-1]]=e.value,i&&i.call(r,n.alias,e)}),!0):!1}function l(e,t,n,i,r){var o=e.tagName;return"SELECT"===o&&"selected"===t?(p.EventListener.addEventListener(e,"change",function(o){var a,l=e.getAttribute("uku-"+t),u=l.split("|");l=u[0],a=u[1],l=c.UkuleleUtil.getFinalAttribute(l);for(var s=l.split("."),p=n.controllerInstance,h=0;h<s.length-1;h++)p=p[s[h]];for(var d=f.Selector.querySelectorAll(e,"option"),g=0;g<d.length;g++){var v=d[g];if(v.selected){var m=JSON.parse(v.getAttribute("data-item"));p[s[s.length-1]]=m}}i&&i.call(r,n.alias,e)}),!0):!1}function u(e,t,n,i,r){var o=e.tagName;return"INPUT"===o&&"value"===t&&"checkbox"===e.getAttribute("type")?(p.EventListener.addEventListener(e,"change",function(o){
var a=e.getAttribute("uku-"+t);a=c.UkuleleUtil.getFinalAttribute(a);for(var l=a.split("."),u=n.controllerInstance,s=0;s<l.length-1;s++)u=u[l[s]];u[l[l.length-1]]=e.checked,i&&i.call(r,n.alias,e)}),!0):!1}function s(e,t,n,i,r){var o=e.tagName;return"INPUT"===o&&"selected"===t&&"radio"===e.getAttribute("type")?(p.EventListener.addEventListener(e,"change",function(o){var a=e.getAttribute("uku-"+t);a=c.UkuleleUtil.getFinalAttribute(a);for(var l=a.split("."),u=n.controllerInstance,s=0;s<l.length-1;s++)u=u[l[s]];e.checked&&(u[l[l.length-1]]=e.value,i&&i.call(r,n.alias,e))}),!0):!1}var c=n(9),p=n(24),f=n(10);t.elementChangedBinder=i},function(e,t){"use strict";var n=function(){function e(){}return e.addEventListener=function(e,t,n){return window.hasOwnProperty("jQuery")&&void 0!==typeof window.jQuery?window.jQuery(e).on(t,function(e){n&&n(e)}):e.addEventListener(t,n)},e}();t.EventListener=n}])});
//# sourceMappingURL=uku.js.map